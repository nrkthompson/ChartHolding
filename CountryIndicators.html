
<!doctype html>
<html style="margin: 0 auto; disaply: block; height: 98%;">

<head>
	<title>Scatter Chart</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
	<style>
	canvas {
		-moz-user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
	}
	</style>
</head>

<body style="margin: 0 auto; disaply: block; height: 100%;" id="bodyID">
	<div style="margin: 0 auto; disaply: block; height: 100%;">
		<canvas id="canvas"></canvas>
	</div>
	<script>
	    var xLabels = {
	      0: 'Country Average', 1: 'Stores/Non-Essential Businesses', 2: 'Schooling/Youth Activities',
	      3: 'Eateries', 4: 'Leisure Activities', 5: 'Contact Services', 6: 'Manufacturing/Construction',
	      7: 'Gatherings', 8: 'Borders/Movement', 9: 'Cultural'
	    };
	    var yLabels = {
	      0: 'Insufficient Data', 1: 'Level 1 (Most Restrictive)', 2: 'Level 2', 3: 'Level 3', 4: 'Level 4', 5: 'Level 5 (Least Restrictive)'
	    };
      
		window.onload = function onboard() {
		      window.addEventListener("message", receiveMessage, false);
		      function receiveMessage(event) {
			console.log(String(event.data));
			if (String(event.data).includes("Verified")) {
			  var country1 = String(event.data).split(",")[0];
			  var country2 = String(event.data).split(",")[1];
			  var country3 = String(event.data).split(",")[2];
			  function generateData(country) {
				var data = [];
				d3.text("https://nrkthompson.github.io/ChartHolding/Data/Indicator_Levels_PEARL.csv", "text/csv", function(text) {
					var csv = d3.csv.parseRows(text);
				for (var i = 0, len = csv.length ; i < len ; i++) {
					if (csv[i][0].includes(country)) {
						data.push({
							x: 0,
							y: csv[i][-1]
						});
						data.push({
							x: 1,
							y: csv[i][9]
						});
						data.push({
							x: 2,
							y: csv[i][8]
						});
						data.push({
							x: 3,
							y: csv[i][7]
						});
						data.push({
							x: 4,
							y: csv[i][6]
						});
						data.push({
							x: 5,
							y: csv[i][5]
						});
						data.push({
							x: 6,
							y: csv[i][4]
						});
						data.push({
							x: 7,
							y: csv[i][3]
						});
						data.push({
							x: 8,
							y: csv[i][2]
						});
						data.push({
							x: 9,
							y: csv[i][1]
						});
					}
				   }
				});
			  }
			  var ctx = document.getElementById('canvas').getContext('2d');
			  window.myScatter = Chart.Scatter(ctx, {
			    data: {
			  datasets: [{
			      label: country1,
			      pointRadius: 3,
			      borderColor: '#D4E6F1',
			      backgroundColor: '#D4E6F1',
			      data: generateData(country1)
			    }, {
			      label: country2,
			      pointRadius: 4,
			      borderColor: '#A9CCE3',
			      backgroundColor: '#A9CCE3',
			      data: generateData(country2)
			    }, {
			      label: country3,
			      pointRadius: 11,
			      borderColor: '#154360',
			      backgroundColor: '#154360',
			      data: generateData(country3)
			    }]
			  },
			    options: {
			      maintainAspectRatio: false,
			      responsive: true,
			      tooltips: {
				  callbacks: {
				label: function(tooltipItem, data) {
				    var label = data.datasets[tooltipItem.datasetIndex].label;
				    return label;
				}
				  }
			      },
			      title: {
				display: true,
				text: 'Level of Reopening by Sector Among OECD Countries and Selected US States'
			      },
			      scales: {
				    yAxes: [{
				  ticks: {
				      min: 0,
				      max: 5,
				      stepSize: 1,
				      callback: function(value, index, values) {
				    return yLabels[value];
				      }
				  }
				    }],
				    xAxes: [{
				  ticks: {
				      min: 0,
				      max: 9,
				      stepSize: 1,
				      callback: function(value, index, values) {
				    return xLabels[value];
				      }
				  }
				    }]
				}
			    }
			  });
			 }
		      }
		};
	
	</script>
</body>

</html>

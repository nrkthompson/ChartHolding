<!doctype html>
<html style="margin: 0 auto; disaply: block; height:98%;  width:98%;">

	<head>
		<title>Line Chart Multiple Axes</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
		<style>
		canvas {
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
		}
		</style>
	</head>

	<body style="margin: 0 auto; disaply: block; height: 100%;  width: 100%;">
		<div style="margin: 0 auto; disaply: block; height: 100%;  width: 100%;">
			<canvas id="canvas"></canvas>
		</div>
		<script>
			function dataMaker() {
				d3.text("https://nrkthompson.github.io/ChartHolding/Data/CountryIndicatorsSourceHistorical.csv", "text/csv", function(text) {
					  var csv1 = d3.csv.parseRows(text);
					  var labelNames = [];
            				  var country1 = [];
					  var country2 = [];
					  for (var i = 0, len = csv1.length; i < len; i++) {
					  	if (csv1[i][-1]*1 == 1) {
							if (csv1[i][0].includes("France")) {
								labelNames.push("May 22");
								if (csv1[i][-2].includes("insufficient")) {
									country1.push(null);
								} else {
									country1.push(csv1[i][-2]*1);
								}
							}
							if (csv1[i][0].includes("Germany")) {
								if (csv1[i][-2].includes("insufficient")) {
									country2.push(null);
								} else {
									country2.push(csv1[i][-2]*1);
								};
							}
						}
						if (csv1[i][-1]*1 == 2) {
							if (labelNames.length == 0) {
								labelNames.push("May 22")
							}
							if (country1.length == 0) {
								labelNames.push(null)
							}
							if (country2.length == 0) {
								labelNames.push(null)
							}
							if (csv1[i][0].includes("France")) {
								labelNames.push("May 29");
								if (csv1[i][-2].includes("insufficient")) {
									country1.push(null);
								} else {
									country1.push(csv1[i][-2]*1);
								}
							}
							if (csv1[i][0].includes("Germany")) {
								if (csv1[i][-2].includes("insufficient")) {
									country2.push(null);
								} else {
									country2.push(csv1[i][-2]*1);
								};
							}
						}
						if (csv1[i][-1]*1 == 3) {
							if (labelNames.length == 1) {
								labelNames.push("May 29")
							}
							if (country1.length == 1) {
								labelNames.push(null)
							}
							if (country2.length == 1) {
								labelNames.push(null)
							}
							if (csv1[i][0].includes("France")) {
								labelNames.push("June 5");
								if (csv1[i][-2].includes("insufficient")) {
									country1.push(null);
								} else {
									country1.push(csv1[i][-2]*1);
								}
							}
							if (csv1[i][0].includes("Germany")) {
								if (csv1[i][-2].includes("insufficient")) {
									country2.push(null);
								} else {
									country2.push(csv1[i][-2]*1);
								};
							}
						}
						if (csv1[i][-1]*1 == 4) {
							if (labelNames.length == 2) {
								labelNames.push("June 5")
							}
							if (country1.length == 2) {
								labelNames.push(null)
							}
							if (country2.length == 2) {
								labelNames.push(null)
							}
							if (csv1[i][0].includes("France")) {
								labelNames.push("June 12");
								if (csv1[i][-2].includes("insufficient")) {
									country1.push(null);
								} else {
									country1.push(csv1[i][-2]*1);
								}
							}
							if (csv1[i][0].includes("Germany")) {
								if (csv1[i][-2].includes("insufficient")) {
									country2.push(null);
								} else {
									country2.push(csv1[i][-2]*1);
								};
							}
						}
						if (csv1[i][-1]*1 == 5) {
							if (labelNames.length == 3) {
								labelNames.push("June 12")
							}
							if (country1.length == 3) {
								labelNames.push(null)
							}
							if (country2.length == 3) {
								labelNames.push(null)
							}
							if (csv1[i][0].includes("France")) {
								labelNames.push("June 19");
								if (csv1[i][-2].includes("insufficient")) {
									country1.push(null);
								} else {
									country1.push(csv1[i][-2]*1);
								}
							}
							if (csv1[i][0].includes("Germany")) {
								if (csv1[i][-2].includes("insufficient")) {
									country2.push(null);
								} else {
									country2.push(csv1[i][-2]*1);
								};
							}
						}
					  }
					console.log(country1)
					console.log(country2)
					window.myData = {
						  labels: labelNames,
						  datasets: [{
						    label: 'France',
						    borderColor: '#04297a',
						    backgroundColor: '#04297a',
						    fill: false,
						    pointRadius: 1,
						    data: country1
						    }, {
						    label: 'Germany',
						    borderColor: '#34baeb',
						    backgroundColor: '#34baeb',
						    fill: false,
						    pointRadius: 1,
						    data: country2
						    }]
						    }  
				});
			}
			dataMaker();
			window.onload = function() {
						setTimeout(() => { 
							var ctx = document.getElementById('canvas').getContext('2d');
							window.myLine = Chart.Line(ctx, {
							  data: window.myData,
							  options: {
							    responsive: true,
							    hoverMode: 'index',
							    stacked: false,
							    maintainAspectRatio: false,
							    tooltips: {
								callbacks: {
								    label: function(tooltipItem, data) {
									return data.datasets[tooltipItem.datasetIndex].label.concat(" - ").concat(data.datasets[tooltipItem.datasetIndex]['data'][tooltipItem.index] + '%');
								    }
								}
							    },
							    legend: {
								    display: true
							    },
							    title: {
								display: false,
								text: 'Western Canada',
								padding: 5
							     },
							     scales: {
								      yAxes: [{
									  ticks: {
									      min: 0,
									      max: 100,
									      stepSize: 25,
									      callback: function(value, index, values) {
										  return value + '%';
									      }
									  }
								      }],
								      xAxes: [{
									  ticks: {
									      display: true
									  }
								      }]
								  }
							   }
							 });
						}, 3000);
				};
		</script>
	</body>

</html>
